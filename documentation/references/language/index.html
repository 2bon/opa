<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>Language Reference | OPA</title> <meta name="description" content="OPA: An open source project to policy-enable your service."> <link type="text/css" rel="stylesheet" href="/assets/style.css"> </head> <body> <nav> <ul class="opa-nav-main--list"> <li class="opa-nav-main--home-item"> <a class="opa-nav-main--link" href="/">Open Policy Agent</a> </li> <li class="opa-nav-main--item"> <a class="opa-nav-main--link" href="/get-opa/">Get OPA</a> </li> <li class="opa-nav-main--item--selected"> Documentation </li> <li class="opa-nav-main--item"> <a class="opa-nav-main--link" href="/examples/working-with-the-opa-repl/">Examples</a> </li> <li class="opa-nav-main--item"> <a class="opa-nav-main--link" href="/community/">Community</a> </li> <li class="opa-nav-main--item"> <a class="opa-nav-main--link" href="https://blog.openpolicyagent.org">Blog</a> </li> </ul> </nav> <header class="opa-header"> <p class="opa-header--fork-me"><a href="https://github.com/open-policy-agent/opa"><img src="/assets/github-corner-right.svg" alt="Fork me on GitHub" width="80" height="80"></a></p> <div class="opa-content"> <div class="opa-header--abstract"> <nav class="opa-header--abstract--nav"> <ul class="opa-header--abstract--nav-list"> <li class="opa-header--abstract--nav-item"> <a class="opa-header--abstract--nav-link" href="/documentation/what-is-policy-enablement/">What is Policy Enablement?</a> </li> <li class="opa-header--abstract--nav-item"> <a class="opa-header--abstract--nav-link" href="/documentation/how-does-opa-work/">How Does OPA Work?</a> </li> <li class="opa-header--abstract--nav-item"> <a class="opa-header--abstract--nav-link" href="/documentation/how-do-i-write-policies/">How Do I Write Policies?</a> </li> <li class="opa-header--abstract--nav-item--selected"> Language Reference </li> <li class="opa-header--abstract--nav-item"> <a class="opa-header--abstract--nav-link" href="/documentation/references/rest/">REST API</a> </li> <li class="opa-header--abstract--nav-item"> <a class="opa-header--abstract--nav-link" href="/documentation/references/deployments/">Deployments</a> </li> <li class="opa-header--abstract--nav-item"> <a class="opa-header--abstract--nav-link" href="/documentation/references/security/">Security</a> </li> </ul> </nav> <h1>Language Reference</h1> <p>This document is the authoritative specification of the Rego policy language (V1). All policies in OPA are written in Rego.</p> </div> </div> </header> <div class="opa-content"> <h2>Built-in Functions</h2> <p>The built-in functions for the language provide basic operations to manipulate scalar values (e.g. numbers and strings), and aggregate functions that summarize complex types.</p> <h3>Inequality</h3> <table> <thead> <tr> <th>Built-in</th> <th>Inputs</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">x != y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">x</code> is not equal to <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">x &lt; y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">x</code> is less than <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">x &lt;= y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">x</code> is less than or equal to <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">x &gt; y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">x</code> is greater than <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">x &gt;= y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">x</code> is greater than or equal to <code class="highlighter-rouge">y</code></td> </tr> </tbody> </table> <h3>Numbers</h3> <table> <thead> <tr> <th>Built-in</th> <th>Inputs</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">z = x + y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">z</code> is the sum of <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">z = x - y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">z</code> is the difference of <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">z = x * y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">z</code> is the product of <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">z = x / y</code></span></td> <td>2</td> <td><code class="highlighter-rouge">z</code> is the quotient of <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">round(x, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is <code class="highlighter-rouge">x</code> rounded to the nearest integer</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">abs(x, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is the absolute value of <code class="highlighter-rouge">x</code></td> </tr> </tbody> </table> <h3>Aggregates</h3> <table> <thead> <tr> <th>Built-in</th> <th>Inputs</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">count(collection, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is the length of the object, array, or set <code class="highlighter-rouge">collection</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">sum(array_or_set, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is the sum of the numbers in <code class="highlighter-rouge">array_or_set</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">max(array_or_set, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is the maximum value in <code class="highlighter-rouge">array_or_set</code></td> </tr> </tbody> </table> <h3>Sets</h3> <table> <thead> <tr> <th>Built-in</th> <th>Inputs</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">s3 = s1 &amp; s2</code></span></td> <td>2</td> <td><code class="highlighter-rouge">s3</code> is the intersection of <code class="highlighter-rouge">s1</code> and <code class="highlighter-rouge">s2</code>.</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">s3 = s1 | s2</code></span></td> <td>2</td> <td><code class="highlighter-rouge">s3</code> is the union of <code class="highlighter-rouge">s1</code> and <code class="highlighter-rouge">s2</code>.</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">s3 = s1 - s2</code></span></td> <td>2</td> <td><code class="highlighter-rouge">s3</code> is the difference between <code class="highlighter-rouge">s1</code> and <code class="highlighter-rouge">s2</code>, i.e., the elements in <code class="highlighter-rouge">s1</code> that are not in <code class="highlighter-rouge">s2</code></td> </tr> </tbody> </table> <h3>Strings</h3> <table> <thead> <tr> <th>Built-in</th> <th>Inputs</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">concat(join, array_or_set, output)</code></span></td> <td>2</td> <td><code class="highlighter-rouge">output</code> is the result of concatenating the elements of <code class="highlighter-rouge">array_or_set</code> with the string <code class="highlighter-rouge">join</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">contains(string, search)</code></span></td> <td>2</td> <td>true if <code class="highlighter-rouge">string</code> contains <code class="highlighter-rouge">search</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">endswith(string, search)</code></span></td> <td>2</td> <td>true if <code class="highlighter-rouge">string</code> ends with <code class="highlighter-rouge">search</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">format_int(number, base, output)</code></span></td> <td>2</td> <td><code class="highlighter-rouge">output</code> is string representation of <code class="highlighter-rouge">number</code> in the given <code class="highlighter-rouge">base</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">indexof(string, search, output)</code></span></td> <td>2</td> <td><code class="highlighter-rouge">output</code> is the index inside <code class="highlighter-rouge">string</code> where <code class="highlighter-rouge">search</code> first occurs, or -1 if <code class="highlighter-rouge">search</code> does not exist</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">lower(string, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is <code class="highlighter-rouge">string</code> after converting to lower case</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">re_match(pattern, value)</code></span></td> <td>2</td> <td>true if the value matches the pattern</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">startswith(string, search)</code></span></td> <td>2</td> <td>true if <code class="highlighter-rouge">string</code> begins with <code class="highlighter-rouge">search</code></td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">substring(string, start, length, output)</code></span></td> <td>2</td> <td><code class="highlighter-rouge">output</code> is the portion of <code class="highlighter-rouge">string</code> from index <code class="highlighter-rouge">start</code> and having a length of <code class="highlighter-rouge">length</code>. If <code class="highlighter-rouge">length</code> is less than zero, <code class="highlighter-rouge">length</code> is the remainder of the <code class="highlighter-rouge">string</code>.</td> </tr> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">upper(string, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is <code class="highlighter-rouge">string</code> after converting to upper case</td> </tr> </tbody> </table> <h3>Types</h3> <table> <thead> <tr> <th>Built-in</th> <th>Inputs</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><span class="opa-keep-it-together"><code class="highlighter-rouge">to_number(x, output)</code></span></td> <td>1</td> <td><code class="highlighter-rouge">output</code> is <code class="highlighter-rouge">x</code> converted to a number</td> </tr> </tbody> </table> <h2><a name="reserved"></a> Reserved Names</h2> <p>The following words are reserved and cannot be used as variable names, rule names, or dot-access style reference arguments:</p> <div class="highlighter-rouge"><pre class="highlight"><code>as
default
false
import
package
not
null
true
with
</code></pre> </div> <h2><a name="grammar"></a> Grammar</h2> <p>Rego’s syntax is defined by the following grammar:</p> <div class="opa-collapse--ignore highlighter-rouge"><pre class="highlight"><code>module         = package { import } policy
package        = "package" ref
import         = "import" package [ "as" var ]
policy         = { rule }
rule           = [ "default" ] rule-head [ "{" rule-body "}" ]
rule-head      = var [ "[" term "]" ] [ = term ]
rule-body      = literal { ";" | [\r\n] literal }
literal        = ( expr | "not" expr ) { with-modifier }
with-modifier  = "with" term "as" term
expr           = term | expr-built-in | expr-infix
expr-built-in  = var "(" [ term { , term } ] ")"
expr-infix     = [ term "=" ] term infix-operator term
term           = ref | var | scalar | array | object | set | array-compr
array-compr    = "[" term "|" rule-body "]"
infix-operator = bool-operator | arith-operator | bin-operator
bool-operator  = "=" | "!=" | "&lt;" | "&gt;" | "&gt;=" | "&lt;="
arith-operator = "+" | "-" | "*" | "/"
bin-operator   = "&amp;" | "|"
ref            = var { ref-arg }
ref-arg        = ref-arg-dot | ref-arg-brack
ref-arg-brack  = "[" ( scalar | var | "_" ) "]"
ref-arg-dot    = "." var
var            = ( ALPHA | "_" ) { ALPHA | DIGIT | "_" }
scalar         = STRING | NUMBER | TRUE | FALSE | NULL
array          = "[" term { "," term } "]"
object         = "{" object-item { "," object-item } "}"
object-item    = ( scalar | ref | var ) ":" term
set            = empty-set | non-empty-set
non-empty-set  = "{" term { "," term } "}"
empty-set      = "set(" ")"
</code></pre> </div> <p>The grammar defined above makes use of the following syntax. See <a href="https://en.wikipedia.org/wiki/Extended_Backus–Naur_Form">the Wikipedia page on EBNF</a> for more details:</p> <div class="opa-collapse--ignore highlighter-rouge"><pre class="highlight"><code>[]     optional (zero or one instances)
{}     repetition (zero or more instances)
|      alteration (one of the instances)
()     grouping (order of expansion)
STRING JSON string
NUMBER JSON number
TRUE   JSON true
FALSE  JSON false
NULL   JSON null
ALPHA  ASCII characters A-Z and a-z
DIGIT  ASCII characters 0-9
</code></pre> </div> </div> <footer class="opa-footer"> <p class="opa-footer--text"> <a class="opa-footer--github--link" href="https://github.com/open-policy-agent/opa"><img src="/assets/icon-github.svg" class="opa-footer--github--icon" width="16" height="16" alt="icon-github.svg">open-policy-agent/opa</a> <a href="https://travis-ci.org/open-policy-agent/opa"><img class="opa-footer--github--ci" width="90" height="20" src="https://travis-ci.org/open-policy-agent/opa.svg?branch=master" alt="Build Status"></a> </p> <p class="opa-footer--text"> Join the discussion on <a class="opa-footer--link" href="http://slack.openpolicyagent.org">Slack</a> or <a class="opa-footer--link" href="https://groups.google.com/forum/?hl=en#!forum/open-policy-agent">Google Groups</a>. Report a bug or request a feature using <a class="opa-footer--link" href="https://github.com/open-policy-agent/opa/issues">GitHub Issues</a>. </p> <p class="opa-footer--text"> © 2016 Open Policy Agent contributors. Licensed under the <a class="opa-footer--link" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. For information about contributing, see <a class="opa-footer--link" href="https://github.com/open-policy-agent/opa/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>. </p> </footer> <script>var OPA_COLLAPSE_CONFIG={classNames:"highlight",baseClassName:"opa-collapse",collapsedClassName:"opa-collapse--collapsed",ignoreClassName:"opa-collapse--ignore",maxHeight:320,targetClassName:"opa-collapse--target"};</script> <script>!function(e,t,a,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=t.createElement(a),o=t.getElementsByTagName(a)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-84550302-1","auto"),ga("send","pageview");</script> <script type="text/javascript" src="/assets/dom.js"></script> <script type="text/javascript" src="/assets/collapse.js"></script> </body> </html>